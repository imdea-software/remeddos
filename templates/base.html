{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html>
<head>    
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>{{ BRANDING.name }} FoD :: {% block title %}{% endblock %}</title>
	<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
	<META HTTP-EQUIV="expires" CONTENT="Wed, 26 Feb 1997 08:21:57 GMT">
	<link REL="SHORTCUT ICON" HREF="{% static 'favicon.ico' %}">
    <!-- Core CSS - Include with every page -->
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <link href="{% static 'css/b5css.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <!-- bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script> 

    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
    {% block extrahead %}{% endblock %}

    <!-- SB Admin CSS - Include with every page -->
    <link href="{% static 'theme/css/sb-admin.css' %}" rel="stylesheet">
    {% block extraheadbottom %}{% endblock %} 
</head>

<body>		
     <!-- TOP NAVBAR -->
    <header class="header bg-dark" id="header">
        {% if user.is_authenticated %}
        <div class="header_toggle"> <button type="button" class="btn btn-dark white-text" data-bs-toggle="offcanvas" data-bs-target="#nav-bar" aria-controls="nav-bar"><i class='bi-list' id="header-toggle"></i></button> </div>
        <div class=""> <img src="{% static 'redimadrid_negativo.png'%}" alt="RediMadrid logo" class="float-end" style="width: 75px; height: 50px;"> </div>
        {% else %}
        <div class="col m-2 p-3"> <a href="{% url 'account_login' %}" class="text-end text-white text-decoration-none fw-light"> <i class='bi-person nav_icon' data-bs-toggle="tooltip" data-bs-placement="top" title="Sign In"></i> <span class="nav_name">Acceder</span> </a>  </div>
        {% endif %}
    </header>
    <!-- END OF TOP NAVBAR -->
    <!-- SIDE NAVBAR -->
    <div class="l-navbar offcanvas offcanvas-start bg-dark"  aria-labelledby="nav-bar" id="nav-bar">
        <nav class="nav">
            <div class=""> 
                {% if user.is_authenticated %}
                <a href="{% url 'group-routes' %}" class="nav_logo text-decoration-none text-wrap"> <i class='bi-shield nav_logo-icon text-danger'></i> <span class="nav_logo-name text-danger">F O D</span> </a>
                <div class="nav_list text-wrap">
                    <a href="{% url 'group-routes' %}" class="nav_link text-white text-decoration-none fw-light text-wrap"> <i class='bi-table nav_icon text-primary' data-bs-toggle="tooltip" data-bs-placement="top" title="Routes"></i> <span class="nav_name">Reglas FW</span></a>  
                    <a href="{% url 'dashboard' %}" class="nav_link text-white text-decoration-none fw-light text-wrap"> <i class='bi-clipboard nav_icon text-info' data-bs-toggle="tooltip" data-bs-placement="top" title="Dashboard"></i> <span class="nav_name">Dashboard</span></a>
                    <a href="#submenu1" class="nav_link text-white text-decoration-none fw-light" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="subMenu1"> <i class='bi-cloud nav_icon text-success' data-bs-toggle="tooltip" data-bs-placement="top" title="Opciones de almacenamiento"></i> <span class="nav_name">Almacenamiento</span> </a>
                        <div class="collapse" id="submenu1">
                            <a href="#" class="nav_link text-white text-decoration-none fw-light text-wrap" data-bs-toggle="modal" data-bs-target="#confbModal" ><i class="bi-files" data-bs-toggle="tooltip" data-bs-placement="top" title="Crear copia de seguridad"></i><span class="nav_name text-wrap">Crear copia de seguridad</span></a>
                            <a href="#" class="nav_link text-white text-decoration-none fw-light"data-bs-toggle="modal" data-bs-target="#confresfileModal"><i class="bi-files" data-bs-toggle="tooltip" data-bs-placement="top" title="Restaurar a partir de una copia de seguridad"></i><span class="nav_name">Restaurar a partir de una copia de seguridad</span></a>
                            <a href="#" class="nav_link text-white text-decoration-none fw-light" data-bs-toggle="modal" data-bs-target="#confresdbModal"><i class="bi-arrow-repeat" data-bs-toggle="tooltip" data-bs-placement="top" title="Sincronizar con la BBDD"></i><span class="nav_name text-wrap">Sincronizar con la BBDD</span></a>
                            <a href="#" class="nav_link text-white text-decoration-none fw-light" data-bs-toggle="modal" data-bs-target="#confsrModal"><i class="bi-router" data-bs-toggle="tooltip" data-bs-placement="top" title="Sincronizar reglas con router"></i><span class="nav_name text-wrap" >Sincronizar reglas con router</span></a>
                          </div>
                          
                          <a href="#" class="nav_link text-white text-decoration-none text-wrap fw-light" data-bs-toggle="modal" data-bs-target="#addRouteM" id="submitButton"> <i class='bi-shield-plus nav_icon text-warning' data-bs-toggle="tooltip" data-bs-placement="top" title="Añadir una regla de FW"></i><span class="nav_name">Añadir una regla de FW</span></a>  
                          <a href="{% url 'user-profile' %}" class="nav_link text-white text-decoration-none fw-light"> <i class='bi-person nav_icon text-info' data-bs-toggle="tooltip" data-bs-placement="top" title="Mi perfil"></i> <span class="nav_name">Mi perfil</span></a>
                    {% if user.is_superuser%} 
                    <a href="{% url 'admin:index'  %}" class="nav_link text-white text-decoration-none fw-light"> <i class='bi-gear nav_icon text-success' data-bs-toggle="tooltip" data-bs-placement="top" title="Panel de Administrador"></i> <span class="nav_name">Admin</span></a> 
                    {% endif %}
                    {% if user.is_staff%} 
                    <a href="{% url 'attack-list'  %}" class="nav_link text-white text-decoration-none fw-light"> <i class='bi-table nav_icon text-danger' data-bs-toggle="tooltip" data-bs-placement="top" title="Registrador de ataquqes"></i> <span class="nav_name">Golem</span></a> 
                    {% endif %}
                </div>
            </div>
            <a href="{% url 'account_logout' %}" class="nav_link linklogout text-white text-decoration-none fw-light"> <i class='bi-person-x-fill nav_icon' data-bs-toggle="tooltip" data-bs-placement="top" title="Salir"></i> <span class="nav_name">Salir</span> </a>
            {% else %}
            <!-- <a href="{% url 'account_login' %}" class="nav_link text-white text-decoration-none fw-light"> <i class='bi-person nav_icon' data-bs-toggle="tooltip" data-bs-placement="top" title="Sign In"></i> <span class="nav_name">Sign In</span> </a> --> 
            {% endif %}
        </nav>
    </div>
    <!-- ENDOFNAVBAR-->
    
    <div class="container-fluid p-5 height-100 bg-light">
      {% block contentplaceholder %}
    {% endblock %}
</div> 

  
   <!-- ADD ROUTE - Modal -->
   <div class="modal" id="addRouteM" tabindex="-1" role="dialog" aria-labelledby="addRouteMLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
              <h5 class="modal-title" id="addRouteMLabel">Añadir una regla FW.</h5>
                  <button type="button" class="btn btn-outline btn-info close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <div class="row">
                      <div class="col text-wrap">
                      <p class="lh-base">Te gustaría configurar una nueva regla de firewall?</p>
                      <p>Introduce el código enviado a su cuenta de slack.</p>  
                      </div>
                  </div>
                </div>
                <div class="modal-footer m-2">
                  {% if user.is_authenticated %}
                  <form action="{% url 'add-route' %}" method="POST" id="verify_user_add" class="row gx-3 gy-2 align-items-center">
                    {% csrf_token %}
                    <div class="row">
                      <label for="id_value" class="col form-label float-start m-2">Código: </label>
                      <input type="text" id="id_value" name="value" class="col form-control m-2 " aria-describedby="valueHelpBlock">
                      <button type="submit" class="btn btn-outline-primary btn-sm col float-end m-2">Sí</button>
                    </div>
                  </form>
                    {% else %}
                    <p>Primero debe identificarse para poder configurar reglas.</p>
                    {% endif %}
        </div>
      </div>
  </div>
</div>
        <!-- Back up File Modal -->
  <div class="modal" id="confbModal" tabindex="-1" role="dialog" aria-labelledby="confbModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
              <h5 class="modal-title" id="confbModalLabel">Confirmación copia de seguridad.</h5>
                  <button type="button" class="btn btn-sm close" data-bs-dismiss="modal" aria-label="Close" id="confbModalClose">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <div class="row">
                      <div class="col text-wrap">
                      <p class="lh-base">Te gustaría crear una copia de seguridad de la actual base de datos?</p>  
                      </div>
                  </div>
                </div>
                <div class="modal-footer m-2">
                  {% if user.is_authenticated %}
                  <button type="button" class="btn btn-outline secondary" data-bs-dismiss="modal">Cerrar</button>
                  <form action="{% url 'backup' %}">
                    <button type="submit" class="btn btn-outline-primary">Sí</button>
                  </form>
                    {% else %}
                    <p>Primero debe identificarse para poder configurar reglas.</p>
                    {% endif %}
        </div>
      </div>
  </div>
</div>
      <!-- Router routes restore Modal -->
      <div class="modal fade" id="confsrModal" tabindex="-1" role="dialog" aria-labelledby="confsrModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
                  <h5 class="modal-title" id="confsrModalLabel">Sincronización de reglas con el router.</h5>
                      <button type="button" class="btn btn-sm close" data-bs-dismiss="modal" aria-label="Close" >
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <div class="row">
                          <div class="col text-wrap">
                          <p class="lh-base">¿Le gustaría sincronizar el router con la aplicación?
                             Es mejor realizar una copia de la base de datos antes de realizar la sincronización para no perder información.</p>  
                          </div>
                      </div>
                    </div>
                    <div class="modal-footer m-2">
                      {% if user.is_authenticated %}
                      <button type="button" class="btn btn-outline secondary" data-bs-dismiss="modal">Cerrar</button>
                      <form action="{% url 'router-sync' %}">
                        <button type="submit" class="btn btn-outline-primary">Sí</button>
                      </form>
                        {% else %}
                        <p>Primero debe identificarse para poder configurar reglas.</p>
                        {% endif %}
            </div>
          </div>
      </div>
    </div>
          <!-- DB routes restore Modal -->
  <div class="modal fade" id="confresdbModal" tabindex="-1" role="dialog" aria-labelledby="confresdbModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
              <h5 class="modal-title" id="confresdbModalLabel">Sincronización de reglas con la BBDD.</h5>
                  <button type="button" class="btn btn-sm close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <div class="row">
                      <div class="col text-wrap">
                      <p class="lh-base">¿Le gustaría sincronizar la base de datos con la aplicación?
                        Es mejor realizar una copia de la base de datos antes de realizar la sincronización para no perder información.</p>  
                      </div>
                  </div>
                </div>
                <div class="modal-footer m-2">
                  {% if user.is_authenticated %}
                  <button type="button" class="btn btn-outline secondary" data-bs-dismiss="modal">Cerrar<button>
                  <form action="{% url 'rsync' %}">
                    <button type="submit" class="btn btn-outline-primary">Sí</button>
                  </form>
                    {% else %}
                    <p>Primero debe identificarse para poder configurar reglas.</p>
                    {% endif %}
        </div>
      </div>
  </div>
</div>
          <!-- Back up File Restore Modal -->
          <div class="modal fade" id="confresfileModal" tabindex="-1" role="dialog" aria-labelledby="confresfModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                      <h5 class="modal-title" id="confresfModalLabel">Restore confirmation</h5>
                          <button type="button" class="btn btn-sm close" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          <div class="row">
                              <div class="col text-wrap">
                              <p class="lh-base">¿Te gustaría restaurar la aplicación a partir de un archivo?</p>  
                              </div>
                          </div>
                        </div>
                        <div class="modal-footer m-2">
                          {% if user.is_authenticated %}
                          <button type="button" class="btn btn-outline secondary" data-bs-dismiss="modal">Cerrar</button>
                          <form action="{% url 'restore' %}">
                            <button type="submit" class="btn btn-outline-primary">Sí</button>
                          </form>
                            {% else %}
                            <p>Primero debe identificarse para poder configurar reglas.</p>
                            {% endif %}
                </div>
              </div>
          </div>
        </div>

    <!-- Core Scripts - Include with every page -->
    <!-- <script src="{% static 'theme/js/jquery-1.10.2.js' %}"></script>
    <script src="{% static 'js/jquery_csrf_protect.js' %}" type="text/javascript"></script> -->
    
    <script src="{% static 'js/b5js.js' %}"></script>

    <script type="text/javascript" src="{% static 'js/jquery.cookie.js' %}"></script>  
    {% block pagejs %}{% endblock %}

    <!-- Page-Level Scripts  - Use for reference -->
    {% block pagejsbottom %}{% endblock %}
    <script type="text/javascript">

  	function setlang(lang){
		$("#langsel").val(lang);
		$("#langform").submit();
	}
  

	$(document).ready(function() {
    $("#confbModal").modal('hide');
    $('#submitButton').click(function(){
      console.log('i am called');
      $.ajax({
              url: "{% url 'add-route' %}",
              type: "GET",
              dataType: "json",
              success: (data) => {
                console.log('it worked');
              },
              error: (error) => {
                console.log(error);
              }
            });
     })
     
  $.ajaxSetup({ cache: false });
  $("#routes_table_next").addClass("btn btn-default");
  $("#routes_table_previous").addClass("btn btn-default");
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
  return new bootstrap.Tooltip(tooltipTriggerEl)
})
});

	</script>

</body>

</html>
