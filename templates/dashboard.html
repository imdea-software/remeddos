{% extends "base.html" %}
{% load static %}
{% load i18n %}


{% block extrahead %}
<link rel="stylesheet" href="{% static 'css/dashboard_style.css' %}">
<link rel="stylesheet" href="{% static 'css/section_style.css' %}">
{% endblock %}
{% block title %}{% trans "Dashboard" %}{% endblock %}
{% block contentplaceholder %}
{% csrf_token %}

        <div class="container">
			<section id="projects">
				<div class="container">
				  <!-- INFO -->
				  <section id="hero">
					<div class="container">
					  <div class="row mb-5">
						<div class="col">
						  <h1 class="font-monospace">REM-e-DDOS</h1>
						  <p>REM-e-DDOS es una aplicación diseñada para la mitigación de ataques, aquí podrá configurar reglas de firewall que le ayude a proteger su red. <br> 
							Está aplicación también recoge información desde REM-Golem para informarle a través de Slack sobre los últimos ataques que haya recibido, proponiendo a su vez
							distintas reglas que usted podrá personalizar a su gusto. Para más información:</p>
						  <div class="col-md-3  align-items-center" style="display:inline-block;">
						  <a href="{% url 'pending-routes' %}" type="button" class="btn btn-outline-dark btn-sm  float-left">Reglas propuestas</a>
						  <a href="{% url 'attack-list' %}" type="button" class="btn btn-outline-dark btn-sm float-right">REM-GOLEM</a>
						</div>
						</div>
					  </div>
					  <div class="row cards">
						<div class="col-md-4 d-flex justify-content-center">
						  <div class="card" style="width: 18rem;">
							<div class="card-body">
								<p class="card-text"> Status: <span class="badge bg-success">ACTIVE</span><br>
							 Cuando el estado de una regla es 'ACTIVE' significa que ha sido guardada en su base de datos y configurada en el router.</p>
							</div>
						  </div>
						</div>
				  
						<div class="col-md-4 d-flex justify-content-center">
						  <div class="card" style="width: 18rem;">
							<div class="card-body">
								<p class="card-text"> Status: <span class="badge bg-info">PENDING</span><br>
									Cuando el estado de una regla es 'PENDING' significa que ha sido propuesta por REM-e-DDOS, está guardada en la base de datos y está a la espera de ser aplicada al router.
							</div>
						  </div>
						</div>
						
						<div class="col-md-4 d-flex justify-content-center">
							<div class="card" style="width: 18rem;">
							  <div class="card-body">
								  <p class="card-text"> Status: <span class="badge bg-danger">ERROR</span><br>
									Cuando el estado de una regla es 'ERROR' significa que ha habido un error a la hora de configurar o eliminar una regla del router, en ese caso 
									porfavor contacte con los administradores de la aplicación. </p>
							  </div>
							</div>
						  </div>

					  </div>
					</div>
				  </section>
				  <!--ENDINFO -->
				<section id="projects">
				  <div class="row align-items-left">
					<div class="col-sm-6">
				  {% for route in routes %}
						{% if route.status == 'ACTIVE' %}
						<div class="card mb-3">
							<h5 class="card-header text-success">{{route.name}}</h5>
						<div class="card-body">
						  	<p class="card-text"> Status: <span class="badge bg-success">{{route.status}}</span>
								{% if route.expires != NoneType %}
								<span class="text-muted"> Expires: {{route.expires}}</span></p>
							{% endif %}
						  	<p class="card-text"><small class="text-muted">Last updated: {{route.last_updated}} by {{route.applier_username_nice}}. 
								{% if route.expires != NoneType %}  
								Days to expire: {{route.days_to_expire}} 
							   {% endif %}
							  </small></p>
							<table class="table table-hover">
								{{ route.get_table|safe|escape }}
							</table>
							</div>
							<div class="card-footer">
							{% if not request.COOKIES.token %}
							<a href="{% url 'edit-route' route.name %}" class="btn btn-info btn-sm btn-warning" id="edit_button_{{route.pk}}">Editar reglas</a>
							{% else %}
							<a href="{% url 'edit' route.name%}"class="btn btn-info btn-sm btn-warning" id="edit_button_{{route.pk}}">Editar reglas</a>
							{% endif %}
							<a href="{% url 'display-graphs' route.name %}" class="btn btn-sm btn-info" id="display_button_{{route.pk}}">Mas información</a>
						</div>
					</div>
						{% elif route.status == 'ERROR' %}
						<div class="card mb-3">
							<h5 class="card-header text-danger">{{route.name}}</h5>
						<div class="card-body">						
							<p class="card-text"> Status: <span class="badge bg-danger">{{route.status}}</span></p>
							<table class="table table-hover">{{route.get_table | safe | escape}} </table>
						</div>
						<div class="card-footer">
							{% if not request.COOKIES.token %}
							<a href="{% url 'edit-route' route.name %}" class="btn btn-sm btn-outline-warning m-1" data-bs-toggle="tooltip" data-bs-placement="top"  id="edit_button_{{route.pk}}"><i class="bi-cloud-arrow-up mr-2"></i>Resincronizar</a>
							{% else %}
							<a href="{% url 'edit' route.name %}" class="btn btn-sm btn-outline-warning m-1" data-bs-toggle="tooltip" data-bs-placement="top"  id="edit_button_{{route.pk}}"><i class="bi-cloud-arrow-up mr-2"></i>Resincronizar</a>
							{% endif %}	
						</div>
					</div>
						{% elif route.status == 'EXPIRED' %}
						<div class="card mb-3">
							<h5 class="card-header text-dark">{{route.name}}</h5>
						<div class="card-body">
							<p class="card-text"> Status: <span class="badge bg-dark">{{route.status}}</span></p>
							<table class="table table-hover">{{route.get_table | safe | escape}} </table>
						</div>
						<div class="card-footer">
							{% if not request.COOKIES.token %}
							<a href="{% url 'edit-route' route.name %}" class="btn btn-sm btn-outline-warning m-1" data-bs-toggle="tooltip" data-bs-placement="top"  id="edit_button_{{route.pk}}"><i class="bi-cloud-arrow-up mr-2"></i>Resincronizar</a>
							{% else %}
							<a href="{% url 'edit' route.name %}" class="btn btn-sm btn-outline-warning m-1" data-bs-toggle="tooltip" data-bs-placement="top"  id="edit_button_{{route.pk}}"><i class="bi-cloud-arrow-up mr-2"></i>Resincronizar</a>
							{% endif %}
						</div>
					</div>
						{% endif %}
						
				{% endfor %}

			</div>
			<!-- <div class="col-sm-6" id="hero"  style="display:block;"> -->
				<div class="col-sm-6"  style="display:block;">
					  <div class="card">
								  <h5 class="card-header text-left text-info ">Shortcuts</h5>
								  <div class="card-body btn-group">
									<div class="card-text btn-group">
									  {% if not request.COOKIES.token %}
									  <a class="btn btn-sm btn-outline-dark float-left" id="routebutton" href="#" data-bs-toggle="modal" data-bs-target="#addRouteM"><i class="bi bi-shield-plus text-warning mr-1"></i>Añadir Regla</a>
									  {% else %}
									  <a href="{% url 'add' %}" class="btn btn-outline-dark btn-sm float-left" id="routebutton"><i class="bi bi-shield-plus text-warning mr-1"></i>Añadir Regla</a>
									  {% endif %}
									  <a class="btn btn-sm btn-outline-dark float-left ml-2" href="{% url 'group-routes' %}"> <i class="bi-table text-secondary mr-1"></i>Reglas</a>
									  <a href="{% url 'pending-routes' %}" type="button" class="btn btn-outline-dark btn-sm float-left ml-2"> <i class="bi-clipboard text-danger mr-1"></i>Reglas propuestas</a>
									  <a class="btn btn-outline-dark btn-sm float-left ml-2" href="{% url 'dashboard' %}"> <i class="bi-clipboard text-info mr-1"></i>Dashboard</a>
								  </div>
								
						</div>
				  </div>
			</div>
		</div>
	</section>
<section>

</section>		

</div>   
{% endblock %}
{% block pagejsbottom %}
<script>
	$('#routebutton').click(function(){
      $.ajax({
              url: "{% url 'add-route' %}",
              type: "GET",
              dataType: "json",
              success: (data) => {
                console.log('it worked');
              },
              error: (error) => {
                console.log(error);
              }
            });
     });
</script>

{% endblock %}